{% extends "dynamic_base.html" %}

{% block title %}
Edit pipeline — {{ pipeline.title }} | Admin
{% endblock %}

{% block content %}

<main class="admin-page">


<a
  href="{{ url_for('admin.add_pipeline') }}"
  class="admin-link"
>
  + Add pipeline
</a>

  <header class="admin-header">
    <h1>Edit pipeline</h1>
    <p>
      Pipeline:
      <strong>{{ pipeline.real_name }}</strong>
    </p>
  </header>

  {% if pipeline %}
<section class="container">

  <form method="post" class="admin-form admin-form-wide">

    <input type="hidden" name="pipeline_id" value="{{ pipeline.id }}">

    <!-- =========================
         Pipeline metadata
         ========================= -->
    <fieldset class="form-section">
      <legend>Pipeline metadata</legend>

      <div class="form-group">
        <label>Title</label>
        <input
          type="text"
          name="title"
          value="{{ pipeline.title }}"
          required
        >
      </div>

    </fieldset>

    <!-- =========================
         Pipeline narrative
         ========================= -->
    <fieldset class="form-section">
      <legend>Pipeline description</legend>

      <div class="form-group">
        <label>
          Description (HTML)
          <button
            type="button"
            class="preview-toggle"
            onclick="togglePreview()"
          >
            Preview
          </button>
        </label>

        <div class="editor-preview-wrapper">

          <textarea
            id="description-editor"
            name="description_html"
            class="code-textarea code-textarea-large"
            oninput="updatePreview()"
            required
          >{{ pipeline.description_html }}</textarea>

          <div
            id="description-preview"
            class="html-preview"
            hidden
          ></div>

        </div>

        <small class="form-hint">
          This HTML is rendered verbatim on the documentation page.
        </small>
      </div>
    </fieldset>

    <!-- =========================
         Actions
         ========================= -->
    <div class="admin-actions admin-actions-sticky">
      <button type="submit" class="btn-primary">
        Save pipeline
      </button>

      <a
        href="{{ url_for('admin.show_pipeline') }}"
        class="btn-secondary"
      >
        Cancel
      </a>

          -

      <a
        href="{{ url_for('admin.edit_pipeline_datasets', 
                          pipeline_id=pipeline.id) }}"
        class="btn-secondary"
      >
        Edit datasets →
      </a>
    </div>

  </form>

</section>
    <section class="admin-danger-zone">
      <h2>Danger zone</h2>
      <p>
        Deleting this pipeline will permanently remove it.
        This action cannot be undone.
      </p>
    
      <form
        method="post"
        action="{{ url_for('admin.delete_pipeline', 
                            pipeline_id=pipeline.id) }}"
        onsubmit="return confirm(
          'Delete pipeline {{ pipeline.title }}? This cannot be undone.'
        );"
      >
        <button type="submit" class="btn-danger">
          Delete pipeline
        </button>
      </form>
    </section>

  {% endif %}

</main>

{% endblock %}




