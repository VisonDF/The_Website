{% extends "base.html" %}

{% block title %}
Edit function — {{ fn.real_name }} | Admin
{% endblock %}

{% block content %}
<main class="admin-page">

  <header class="admin-header">
    <h1>Edit function implementation</h1>
    <p>
      Function ID: {{ fn.id }}<br>
      Created at: {{ fn.created_at }}
    </p>
  </header>

<form method="post" class="admin-form admin-form-wide">

  <!-- =========================
       Identity
       ========================= -->
  <fieldset class="form-section">
    <legend>Identity</legend>

    <div class="form-group">
      <label>Function name</label>
      <input
        type="text"
        name="real_name"
        value="{{ fn.real_name }}"
        required
      >
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>API level</label>
        <select name="api_level" required>
          <option value="high" {% if fn.api_level == "high" %}selected{% endif %}>
            High-level API
          </option>
          <option value="low" {% if fn.api_level == "low" %}selected{% endif %}>
            Low-level API
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Function family</label>
        <select name="family_id" required>
          {% for fam in families %}
            <option
              value="{{ fam.id }}"
              {% if fam.id == fn.family_id %}selected{% endif %}
            >
              {{ fam.display_name }}
            </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>Network</label>
      <select name="network" required>
        <option value="no" {% if not fn.network %} selected {% endif %} >No</option>
        <option value="yes" {% if fn.network %} selected {% endif %} >Yes</option>
      </select>
    </div>

    <div class="form-group">
      <label>GPU</label>
      <select name="gpu" required>
        <option value="no" {% if not fn.gpu %} selected {% endif %} >No</option>
        <option value="yes" {% if fn.gpu %} selected {% endif %} >Yes</option>
      </select>
    </div>

  </fieldset>

  <!-- =========================
       Documentation defaults
       ========================= -->
  <fieldset class="form-section">
    <legend>Documentation</legend>

    <div class="form-group">
      <label>Default dataset</label>
      <select name="default_dataset_id">
        <option value="">— None —</option>
        {% for ds in datasets %}
          <option
            value="{{ ds.id }}"
            {% if fn.default_dataset_id == ds.id %}selected{% endif %}
          >
            {{ ds.name }} ({{ ds.version }})
          </option>
        {% endfor %}
      </select>
      <small class="form-hint">
        Used as the default dataset shown on documentation pages.
      </small>
    </div>
  </fieldset>

  <!-- =========================
       Signature
       ========================= -->
  <fieldset class="form-section">
    <legend>Signature</legend>

    <div class="form-group">
      <label>Signature (HTML)</label>
      <textarea
        id="signature-editor"
        name="signature_html"
        class="code-textarea"
        rows="4"
      >{{ fn.signature_html or "" }}</textarea>
    </div>

  <!-- =========================
       Description + preview
       ========================= -->

    <div class="form-group">
      <label>
        Description (HTML)
        <button
          type="button"
          class="preview-toggle"
          onclick="togglePreview()"
        >
          Preview
        </button>
      </label>

      <div class="editor-preview-wrapper">
        <textarea
          id="description-editor"
          name="description_html"
          class="code-textarea code-textarea-large"
          oninput="updatePreview()"
        >{{ fn.description_html or "" }}</textarea>

        <div
          id="description-preview"
          class="html-preview"
          hidden
        ></div>
      </div>
    </div>
  </fieldset>

  <!-- =========================
       Actions
       ========================= -->
  <div class="admin-actions admin-actions-sticky">
    <div>
      <button type="submit" class="btn-primary">
        Save changes
      </button>

      <a
        href="{{ url_for('admin.show_function_impl', function_id=fn.id) }}"
        class="btn-secondary"
      >
        Cancel
      </a>

    -

      <a
        href="{{ url_for('admin.edit_bench', function_id=fn.id) }}"
        class="btn-secondary"
      >
        Edit benchmarks →
      </a>
    </div>

  </div>

</form>

<section class="admin-danger-zone">
      <h2>Danger zone</h2>
      <p>
        Deleting this function implementation will permanently remove it.
        This action cannot be undone.
      </p>
    
      <form
        method="post"
        action="{{ url_for('admin.delete_function_impl', function_id=fn.id) }}"
        onsubmit="return confirm(
          'Delete function {{ fn.real_name }}? This cannot be undone.'
        );"
      >
        <button type="submit" class="btn-danger">
          Delete function implementation
        </button>
      </form>
    </section>


</main>
{% endblock %}



