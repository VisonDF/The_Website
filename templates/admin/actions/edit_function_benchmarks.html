{% extends "base.html" %}

{% block title %}
Edit benchmarks — {{ fn.real_name }} | Admin
{% endblock %}

{% block content %}

<main class="admin-page">


<a
  href="{{ url_for('admin.add_function_benchmark', function_id=fn.id) }}"
  class="admin-link"
>
  + Add benchmark
</a>

  <header class="admin-header">
    <h1>Edit benchmark</h1>
    <p>
      Function:
      <strong>{{ fn.real_name }}</strong>
      ({{ fn.api_level }} level)
    </p>
  </header>

  {% if benchmark %}
<section class="container">

  <form method="post" class="admin-form admin-form-wide">

    <input type="hidden" name="benchmark_id" value="{{ benchmark.id }}">

    <!-- =========================
         Benchmark metadata
         ========================= -->
    <fieldset class="form-section">
      <legend>Benchmark metadata</legend>

      <div class="form-group">
        <label>Title</label>
        <input
          type="text"
          name="title"
          value="{{ benchmark.title }}"
          required
        >
      </div>
    </fieldset>

    <!-- =========================
         Benchmark narrative
         ========================= -->
    <fieldset class="form-section">
      <legend>Benchmark description</legend>

      <div class="form-group">
        <label>
          Description (HTML)
          <button
            type="button"
            class="preview-toggle"
            onclick="togglePreview()"
          >
            Preview
          </button>
        </label>

        <div class="editor-preview-wrapper">

          <textarea
            id="description-editor"
            name="description_html"
            class="code-textarea code-textarea-large"
            oninput="updatePreview()"
            required
          >{{ benchmark.description_html }}</textarea>

          <div
            id="description-preview"
            class="html-preview"
            hidden
          ></div>

        </div>

        <small class="form-hint">
          This HTML is rendered verbatim on the documentation page.
        </small>
      </div>
    </fieldset>

    <!-- =========================
         Actions
         ========================= -->
    <div class="admin-actions admin-actions-sticky">
      <button type="submit" class="btn-primary">
        Save benchmark
      </button>

      <a
        href="{{ url_for('admin.show_benchs', benchmark_id=benchmark.id) }}"
        class="btn-secondary"
      >
        Cancel
      </a>

          -

      <a
        href="{{ url_for('admin.edit_benchmark_datasets', benchmark_id=benchmark.id) }}"
        class="btn-secondary"
      >
        Edit datasets →
      </a>
    </div>

  </form>

</section>
    <section class="admin-danger-zone">
      <h2>Danger zone</h2>
      <p>
        Deleting this function benchmark will permanently remove it.
        This action cannot be undone.
      </p>
    
      <form
        method="post"
        action="{{ url_for('admin.delete_function_bench', function_id=fn.id) }}"
        onsubmit="return confirm(
          'Delete benchmark {{ benchmark.title }}? This cannot be undone.'
        );"
      >
        <button type="submit" class="btn-danger">
          Delete function implementation
        </button>
      </form>
    </section>

  {% endif %}

</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".benchmark-edit-card").forEach(card => {
    const textarea = card.querySelector(".html-editor");
    const preview = card.querySelector(".html-preview");
    const toggleBtn = card.querySelector(".toggle-btn");

    let previewVisible = false;

    function updatePreview() {
      preview.innerHTML = textarea.value;
    }

    toggleBtn.addEventListener("click", () => {
      previewVisible = !previewVisible;

      textarea.style.display = previewVisible ? "none" : "block";
      preview.classList.toggle("hidden", !previewVisible);

      if (previewVisible) updatePreview();
    });

    textarea.addEventListener("input", () => {
      if (previewVisible) updatePreview();
    });
  });
});
</script>

{% endblock %}




