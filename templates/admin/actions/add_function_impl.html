{% extends "base.html" %}

{% block title %}
Add function implementation | Admin
{% endblock %}

{% block content %}
<main class="admin-page">

  <header class="admin-header">
    <h1>Add function implementation</h1>
    <p>Create a new concrete function implementation.</p>
  </header>

  <form method="post" class="admin-form admin-form-wide">

    <!-- Core metadata -->
    <fieldset class="form-section">
      <legend>Function metadata</legend>

      <div class="form-group">
        <label>Function name</label>
        <input
          type="text"
          name="real_name"
          placeholder="e.g. group_by_hash"
          required
        >
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>API level</label>
          <select name="api_level" required>
            <option value="">— Select API level —</option>
            <option value="high">High-level API</option>
            <option value="low">Low-level API</option>
          </select>
        </div>

        <div class="form-group">
          <label>Function family</label>
          <select name="family_id" required>
            <option value="">— Select family —</option>
            {% for fam in families %}
              <option value="{{ fam.id }}">
                {{ fam.display_name }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Default dataset (for docs)</label>
        <select name="default_dataset_id">
          <option value="">— None —</option>
          {% for ds in datasets %}
            <option value="{{ ds.id }}">
              {{ ds.name }} ({{ ds.version }})
            </option>
          {% endfor %}
        </select>
      </div>
    </fieldset>

    <!-- Code / HTML -->
    <fieldset class="form-section">
      <legend>Documentation content</legend>

      <div class="form-group">
        <label>Signature (HTML)</label>
        <textarea
          id="signature-editor"
          name="signature_html"
          class="code-textarea code-textarea-small"
          placeholder="<code>group_by(col)</code>"
        ></textarea>
      </div>

  <div class="form-group">
  <label>
    Description (HTML)
    <button
      type="button"
      class="preview-toggle"
      onclick="togglePreview()"
    >
      Preview
    </button>
  </label>

  <div class="editor-preview-wrapper">

    <textarea
      id="description-editor"
      name="description_html"
    ></textarea>
    
    <div
      id="description-preview"
      class="html-preview"
      hidden
    ></div>
    
      </div>
    </div>    

    </fieldset>

    <!-- Actions -->
    <div class="admin-actions admin-actions-sticky">
      <button type="submit" class="btn-primary">
        Create function
      </button>

      <a href="{{ url_for('admin.show_function_impl') }}" class="btn-link">
        Cancel
      </a>
    </div>

  </form>

  <br>

</main>
{% endblock %}
